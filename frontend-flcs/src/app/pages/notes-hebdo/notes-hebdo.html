<div class="container-fluid p-4">

  <h3 class="fw-bold mb-4">Saisie des notes hebdomadaires</h3>

  <!-- SÃ©lection Niveau / Semaine -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <label class="form-label fw-bold">Niveau</label>
      <select class="form-select"
              [(ngModel)]="selectedNiveauId"
              (change)="onNiveauChange()">
        <option value="">-- Choisir un niveau --</option>
        <option *ngFor="let n of niveaux" [value]="n.id">{{ n.code }}</option>
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label fw-bold">Semaine</label>
      <select class="form-select"
              [(ngModel)]="selectedSemaine"
              (change)="loadNotes()"
              [disabled]="!selectedNiveauId || semaines.length === 0">
        <option value="">-- Choisir une semaine --</option>
        <option *ngFor="let s of semaines" [value]="s">Semaine {{ s }}</option>
      </select>
    </div>

    <div class="col-md-4 text-end">
      <button class="btn btn-outline-secondary w-100"
              (click)="resetSelection()">
        <i class="bi bi-arrow-clockwise me-2"></i>RÃ©initialiser
      </button>
    </div>
  </div>

  <!-- Tableau des notes -->
  <div *ngIf="notes.length > 0" class="card shadow-sm border-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
          <tr>
            <th>Ã‰lÃ¨ve</th>
            <th class="text-center">LES</th>
            <th class="text-center">HOR</th>
            <th class="text-center">SCHREIB</th>
            <th class="text-center">GRAMM</th>
            <th class="text-center">SPRE</th>
            <th class="text-end">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let n of notes">
            <td>{{ n.nom }} {{ n.prenom }}</td>

            <td><input type="number" class="form-control text-center" [(ngModel)]="n.les" min="0" max="20"></td>
            <td><input type="number" class="form-control text-center" [(ngModel)]="n.hor" min="0" max="20"></td>
            <td><input type="number" class="form-control text-center" [(ngModel)]="n.schreib" min="0" max="20"></td>
            <td><input type="number" class="form-control text-center" [(ngModel)]="n.gramm" min="0" max="20"></td>
            <td><input type="number" class="form-control text-center" [(ngModel)]="n.spre" min="0" max="20"></td>

            <td class="text-end">
              <button class="btn btn-sm btn-success"
                      (click)="saveNote(n)"
                      [disabled]="!selectedNiveauId || !selectedSemaine">
                ðŸ’¾ Enregistrer
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="loading" class="text-center p-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2">Chargement...</p>
  </div>

  <div *ngIf="!loading && notes.length === 0 && selectedNiveauId && selectedSemaine"
       class="text-center p-5 text-muted">
    <i class="bi bi-clipboard-x display-4"></i>
    <p class="mt-3">Aucune note pour cette semaine.</p>
  </div>

</div>
<p class="text-muted small mt-2">
  Niveau: {{ selectedNiveauId }} | Semaine: {{ selectedSemaine }}
</p>
